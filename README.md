# middleware-ios
---
<p align="center">
    <a href="https://github.com/middleware-labs/middleware-ios/releases">
        <img alt="Build Status" src="https://img.shields.io/badge/status-beta-orange">
      </a>
    <a href="https://github.com/middleware-labs/middleware-ios/actions/workflows/BuildAndTest.yml?query=branch%3Amain+">
        <img alt="GitHub release (latest SemVer)" src="https://github.com/middleware-labs/middleware-ios/actions/workflows/BuildAndTest.yml/badge.svg">
    </a>
    <a href="https://github.com/middleware-labs/middleware-android/releases">
        <img alt="GitHub release (latest SemVer)" src="https://img.shields.io/github/v/release/middleware-labs/middleware-ios?include_prereleases&style=flat">
    </a>
</p>

---

## Features

- Access to OpenTelemetry APIs
- Network Monitoring
- Crash Reporting
- AppLifecycle Instrumentation
- Slow Rendering Detection
- WebView Instrumentation
- Api for sending custom errors & record exceptions
- Custom logging
- Session Recording
            
## Setup
            
### Add the following line in `Package.swift` in `dependencies`
            
```swift
.package(url: "https://github.com/middleware-labs/middleware-ios", from: "1.0.3"),
```

## Using Cocoapods

```ruby
pod "MiddlewareRum", "~> 1.0.3"
```

## Initialization of Middleware iOS sdk
            
```swift
import SwiftUI
import MiddlewareRum
            
@main
struct YourApp: App {
    init() {
        MiddlewareRumBuilder()
            .globalAttributes(["customerId" : "123456"])
            .target("<target>")
            .serviceName("Mobile-SDK-iOS")
            .projectName("Mobile-SDK-iOS")
            .rumAccessToken("<account-key>")
            .deploymentEnvironment("PROD")
            .build()
        
    }
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}
```

## Documentation

### Configurations

Methods that can be used for setting instrumentation & configure your application.
                                
<table>
    <thead>
        <tr><td>Option</td><td>Description</td><tr>
    </thead>
    <tbody>
        <tr>
            <td>
                <code lang="swift">.rumAccessToken(String)</code>
            </td>
            <td>
                Sets the RUM account access token to authorize client to send telemetry data to Middleware
            </td>
        </tr>
        <tr>
            <td>
                <code lang="swift">.target(String)</code>
            </td>
            <td>
                Sets the target URL to which you want to send telemetry data. For example - Unified Observability Platform | Middleware
            </td>
        </tr>
        <tr>
            <td>
                <code lang="swift">.serviceName(String)</code>
            </td>
            <td>
                Sets the service name for your application. This can be used further for filtering by service name.
            </td>
        </tr>
        <tr>
            <td>
                <code lang="swift">.projectName(String)</code>
            </td>
            <td>
                Sets the project name for your application.
            </td>
        </tr>
        <tr>
            <td>
                <code lang="swift">.deploymentEnvironment(String)</code>
            </td>
            <td>
                Sets the environment attribute on the spans that are generated by the instrumentation. For Example - PROD | DEV
            </td>
        </tr>
        <tr>
            <td>
                <code lang="swift">.disableCrashReportingInstrumentation()</code>
            </td>
            <td>
                Disable crash reporting. By default it is enabled.
            </td>
        </tr>
        <tr>
            <td>
                <code lang="swift">.disableNetworkMonitoring()</code>
            </td>
            <td>
                Disable HTTP Instrumentation. By default it is enabled.
            </td>
        </tr>
        <tr>
            <td>
                <code lang="swift">.disableSlowRenderingDetection()</code>
            </td>
            <td>
                Disable slow or frozen frame renders. By default it is enabled.
            </td>
        </tr>
        <tr>
            <td>
                <code lang="swift">.slowFrameDetectionThresholdMs(Double)</code>
            </td>
            <td>
                Sets the default polling for slow render detection. Default value in milliseconds is 16.7
            </td>
        </tr>
        <tr>
            <td>
                <code lang="swift">.frozenFrameDetectionThresholdMs(Double)</code>
            </td>
            <td>
                Sets the default polling for slow render detection. Default value in milliseconds is 700
            </td>
        </tr>
    </tbody>
</table>

### Logging using Middleware API

```swift

MiddlewareRum.info("Some information")
MiddlewareRum.debug("Some information")
MiddlewareRum.trace("Some information")
MiddlewareRum.warning("Some information")
MiddlewareRum.error("Some information")
MiddlewareRum.critical("Some information")
```

### Adding custom error to trace

```swift
MiddlewareRum.addError("Unable to process I am error")
```

### Custom Exception

```swift
MiddlewareRum.addException(e: NSException(name: NSExceptionName(rawValue: "RuntimeException"), reason: "I am custom exception"))
```

### Set screen name

```swift
MiddlewareRum.setScreenName("WebView")
```

### Set Global Attributes

```swift
MiddlewareRum.setGlobalAttributes(["some": "value"])
```

### WebView Instrumentation

```swift
MiddlewareRum.integrateWebViewWithBrowserRum(view: webView)
```

### Enable Session Recording

By default session recording is enabled, to disable call `.disableRecording()` :

```swift
    MiddlewareRumBuilder()
        .globalAttributes(["customerId" : "123456"])
        .target("<target>")
        .serviceName("Mobile-SDK-iOS")
        .projectName("Mobile-SDK-iOS")
        .rumAccessToken("<account-key>")
        .deploymentEnvironment("PROD")
        .disableRecording()
        .build()
```

#### Sensitive views (View will get blurred) 

```swift

//SwiftUI
Text("Very important sensitive text").sensitive()

// UIKit
MiddlewareRum.addIgnoredView(view)
```
